<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨ - ExamPro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header
            style="position: sticky; top: 0; z-index: 1000; background: white; padding: 1rem 0; border-radius: 16px; margin-bottom: 2rem; box-shadow: var(--shadow-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div
                        style="width: 50px; height: 50px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-graduate" style="color: white; font-size: 1.5rem;"></i>
                    </div>
                    <div>
                        <h1 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-800); margin: 0;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…
                            Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
                        <p style="color: var(--gray-600); margin: 0; font-size: 0.9rem;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="btn btn-secondary" onclick="performLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </header>

        <!-- Statistics Cards -->
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="card" style="text-align: center;">
                <div
                    style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <i class="fas fa-graduation-cap" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <h3 style="font-size: 2rem; font-weight: 800; color: var(--primary); margin: 0;" id="enrolledCourses">0
                </h3>
                <p style="color: var(--gray-600); margin: 0.5rem 0;">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
                <div style="color: var(--success); font-size: 0.9rem;">
                    <i class="fas fa-arrow-up"></i> +1 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <div
                    style="width: 60px; height: 60px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <i class="fas fa-clipboard-list" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <h3 style="font-size: 2rem; font-weight: 800; color: var(--warning); margin: 0;"
                    id="availableExamsCount">0
                </h3>
                <p style="color: var(--gray-600); margin: 0.5rem 0;">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                <div style="color: var(--warning); font-size: 0.9rem;">
                    <i class="fas fa-clock"></i> 2 Ø¬Ø¯ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <div
                    style="width: 60px; height: 60px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <i class="fas fa-check-circle" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <h3 style="font-size: 2rem; font-weight: 800; color: var(--success); margin: 0;" id="completedExams">0
                </h3>
                <p style="color: var(--gray-600); margin: 0.5rem 0;">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
                <div style="color: var(--success); font-size: 0.9rem;">
                    <i class="fas fa-arrow-up"></i> +3 Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <div
                    style="width: 60px; height: 60px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <i class="fas fa-trophy" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <h3 style="font-size: 2rem; font-weight: 800; color: var(--secondary); margin: 0;" id="averageScore">0%
                </h3>
                <p style="color: var(--gray-600); margin: 0.5rem 0;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</p>
                <div style="color: var(--success); font-size: 0.9rem;">
                    <i class="fas fa-arrow-up"></i> +5% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <button class="btn btn-primary" onclick="viewAvailableExams()">
                    <i class="fas fa-clipboard-list"></i>
                    Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                </button>
                <button class="btn btn-success" onclick="window.location.href='courses.html'">
                    <i class="fas fa-graduation-cap"></i>
                    Ø¯ÙˆØ±Ø§ØªÙŠ
                </button>
                <button class="btn btn-warning" onclick="window.location.href='results.html'">
                    <i class="fas fa-chart-bar"></i>
                    Ù†ØªØ§Ø¦Ø¬ÙŠ
                </button>
                <button class="btn btn-secondary" onclick="showAlert('Ø¬Ø§Ø±ÙŠ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...', 'info')">
                    <i class="fas fa-user"></i>
                    Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                </button>
            </div>
        </div>

        <!-- Available Exams -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
            </div>
            <div id="availableExamsList" style="max-height: 400px; overflow-y: auto;">
                <!-- Exams will be loaded here -->
            </div>
        </div>

        <!-- Enrolled Courses -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Ø¯ÙˆØ±Ø§ØªÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>
            </div>
            <div id="enrolledCoursesList" style="max-height: 400px; overflow-y: auto;">
                <!-- Enrolled courses will be loaded here -->
            </div>
        </div>

        <!-- Recent Results -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Ø£Ø­Ø¯Ø« Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
            </div>
            <div id="recentResults" style="max-height: 400px; overflow-y: auto;">
                <!-- Results will be loaded here -->
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        // Check authentication
        if (!checkAuth()) {
            window.location.href = '../login.html';
        }

        // Check if user is student
        if (!api.isStudent()) {
            showAlert('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©', 'danger');
            setTimeout(() => {
                window.location.href = '../login.html';
            }, 2000);
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                console.log('ğŸ“Š Loading student dashboard data...');
                showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

                // Load available exams using API service
                try {
                    console.log('ğŸ” Checking available exams...');

                    // First, let's debug the data
                    try {
                        const debugInfo = await api.getStudentDebugInfo();
                        console.log('ğŸ› Debug info:', debugInfo);

                        console.log(`ğŸ‘¤ Current Student ID: ${debugInfo.currentStudentId}`);
                        console.log(`ğŸ“š All Students: ${debugInfo.allStudentsCount}`);
                        console.log(`ğŸ“ All Enrollments: ${debugInfo.allEnrollmentsCount}`);
                        console.log(`ğŸ“‹ All Exams: ${debugInfo.allExamsCount}`);
                        console.log(`ğŸ¯ Student Enrollments: ${debugInfo.studentEnrollmentsCount}`);

                        // Show debug info in UI
                        const debugDiv = document.createElement('div');
                        debugDiv.style.cssText = 'background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px;';
                        debugDiv.innerHTML = `
                            <strong>Debug Info:</strong><br>
                            Student ID: ${debugInfo.currentStudentId}<br>
                            All Students: ${debugInfo.allStudentsCount}<br>
                            All Enrollments: ${debugInfo.allEnrollmentsCount}<br>
                            All Exams: ${debugInfo.allExamsCount}<br>
                            Your Enrollments: ${debugInfo.studentEnrollmentsCount}<br>
                            <button onclick="enrollInAllCourses()" style="margin-top: 10px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
                                ğŸ“ Enroll in All Courses
                            </button>
                            <button onclick="createTestData()" style="margin-top: 10px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">
                                ğŸŒ± Create Test Data
                            </button>
                            <button onclick="fixExamDates()" style="margin-top: 10px; margin-right: 5px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer;">
                                ğŸ”§ Fix Exam Dates
                            </button>
                        `;
                        document.getElementById('availableExamsList').prepend(debugDiv);

                    } catch (debugError) {
                        console.error('âŒ Debug info failed:', debugError);
                    }

                    const availableExams = await api.getStudentAvailableExams();
                    console.log('âœ… Available exams loaded:', availableExams);

                    // Debug: Log first exam structure
                    if (availableExams.length > 0) {
                        console.log('ğŸ” First exam structure:', availableExams[0]);
                        console.log('ğŸ” Available fields:', Object.keys(availableExams[0]));
                    }

                    // Update available exams count
                    document.getElementById('availableExamsCount').textContent = availableExams.length;

                    const availableExamsHtml = availableExams.map(exam => `
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid var(--gray-100); hover: background: var(--gray-50);">
                            <div style="width: 40px; height: 40px; background: var(--warning); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-clipboard-list" style="color: white; font-size: 1rem;"></i>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; font-size: 1rem; color: var(--gray-800);">${exam.Title || exam.title || 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h4>
                                <p style="margin: 0.25rem 0; color: var(--gray-600); font-size: 0.9rem;">${exam.CourseName || exam.courseName || 'Ø¯ÙˆØ±Ø©'}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: var(--gray-500); font-size: 0.8rem;">
                                        <i class="fas fa-clock"></i> ${exam.DurationMinutes || exam.durationMinutes || 0} Ø¯Ù‚ÙŠÙ‚Ø© â€¢ ${exam.QuestionCount || exam.questionCount || 0} Ø³Ø¤Ø§Ù„
                                    </span>
                                    <button class="btn btn-primary btn-sm" onclick="startExam(${exam.Id || exam.id})" ${exam.IsTaken || exam.isTaken ? 'disabled' : ''}>
                                        ${exam.IsTaken || exam.isTaken ? 'ØªÙ… Ø£Ø¯Ø§Ø¤Ù‡' : 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('availableExamsList').innerHTML = availableExamsHtml || '<p style="text-align: center; color: var(--gray-500); padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                } catch (error) {
                    console.error('âŒ Failed to load available exams:', error);
                    document.getElementById('availableExamsList').innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©: ' + error.message + '</p>';
                }

                // Load exam history using API service
                try {
                    const examHistory = await api.getStudentExamHistory();
                    console.log('âœ… Exam history loaded:', examHistory);

                    // Update completed exams count
                    document.getElementById('completedExams').textContent = examHistory.length;

                    // Calculate average score
                    if (examHistory.length > 0) {
                        const validExams = examHistory.filter(exam => 
                            exam.Percentage !== null && 
                            exam.Percentage !== undefined && 
                            !isNaN(exam.Percentage)
                        );
                        
                        if (validExams.length > 0) {
                            const totalPercentage = validExams.reduce((sum, exam) => sum + exam.Percentage, 0);
                            const averagePercentage = (totalPercentage / validExams.length).toFixed(1);
                            document.getElementById('averageScore').textContent = averagePercentage + '%';
                        } else {
                            document.getElementById('averageScore').textContent = '0%';
                        }
                    } else {
                        document.getElementById('averageScore').textContent = '0%';
                    }

                    // Display recent results (last 5)
                    const recentResults = examHistory.slice(0, 5);
                    const recentResultsHtml = recentResults.map(result => {
                        // Ensure percentage is valid
                        const percentage = (result.Percentage !== null && result.Percentage !== undefined && !isNaN(result.Percentage)) 
                            ? result.Percentage.toFixed(1) 
                            : '0.0';
                        
                        // Format date safely
                        const formattedDate = result.SubmittedTime 
                            ? formatDate(result.SubmittedTime) 
                            : 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…ØªØ§Ø­';
                        
                        return `
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid var(--gray-100); hover: background: var(--gray-50);">
                            <div style="width: 40px; height: 40px; background: ${result.Passed ? 'var(--success)' : 'var(--danger)'}; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas ${result.Passed ? 'fa-check' : 'fa-times'}" style="color: white; font-size: 1rem;"></i>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; font-size: 1rem; color: var(--gray-800);">${result.ExamTitle || 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h4>
                                <p style="margin: 0.25rem 0; color: var(--gray-600); font-size: 0.9rem;">${result.CourseName || 'Ø¯ÙˆØ±Ø©'}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: var(--gray-500); font-size: 0.8rem;">${formattedDate}</span>
                                    <span style="color: ${result.Passed ? 'var(--success)' : 'var(--danger)'}; font-size: 0.9rem; font-weight: 600;">
                                        ${percentage}%
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                    }).join('');

                    document.getElementById('recentResults').innerHTML = recentResultsHtml || '<p style="text-align: center; color: var(--gray-500); padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø³Ø§Ø¨Ù‚Ø©</p>';
                } catch (error) {
                    console.error('âŒ Failed to load exam history:', error);
                    document.getElementById('recentResults').innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>';
                }

                // Load enrolled courses count using actual enrollment data
                try {
                    console.log('ğŸ“š Loading enrolled courses count...');
                    const enrollmentStatus = await api.checkEnrollmentStatus();
                    console.log('âœ… Enrollment status loaded:', enrollmentStatus);

                    // Use the actual enrolled courses count from the API
                    const enrolledCount = enrollmentStatus.enrolledCoursesCount || enrollmentStatus.EnrolledCoursesCount || 0;
                    document.getElementById('enrolledCourses').textContent = enrolledCount;

                    console.log(`ğŸ“Š Enrolled courses count: ${enrolledCount}`);

                    // Display enrolled courses
                    const enrolledCourses = enrollmentStatus.enrolledCourses || [];
                    const enrolledCoursesHtml = enrolledCourses.map(course => `
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid var(--gray-100); hover: background: var(--gray-50);">
                            <div style="width: 40px; height: 40px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-graduation-cap" style="color: white; font-size: 1rem;"></i>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; font-size: 1rem; color: var(--gray-800);">${course.courseName || course.CourseName}</h4>
                                <p style="margin: 0.25rem 0; color: var(--gray-600); font-size: 0.9rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${formatDate(course.enrolledDate || course.EnrolledDate)}</p>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="window.location.href='courses.html'">
                                Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    `).join('');

                    document.getElementById('enrolledCoursesList').innerHTML = enrolledCoursesHtml || '<p style="text-align: center; color: var(--gray-500); padding: 2rem;">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø£ÙŠ Ø¯ÙˆØ±Ø© Ø¨Ø¹Ø¯</p>';
                } catch (error) {
                    console.error('âŒ Failed to load enrolled courses:', error);
                    document.getElementById('enrolledCourses').textContent = '0';
                    document.getElementById('enrolledCoursesList').innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>';
                }

            } catch (error) {
                console.error('âŒ Failed to load dashboard data:', error);
                showAlert('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // Enroll in all courses function
        async function enrollInAllCourses() {
            try {
                console.log('ğŸ“ Enrolling in all courses...');
                showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª...');

                const result = await api.enrollStudentInAllCourses();
                console.log('âœ… Enrolled in all courses:', result);

                showAlert(`ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ ${result.newEnrollments} Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©!`, 'success');

                // Reload page to see new data
                setTimeout(() => {
                    window.location.reload();
                }, 2000);

            } catch (error) {
                console.error('âŒ Error enrolling in courses:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // Create test data function
        async function createTestData() {
            try {
                console.log('ğŸŒ± Creating test data...');
                showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');

                const result = await api.createStudentData();
                console.log('âœ… Test data created:', result);

                showAlert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');

                // Reload the page to see the new data
                setTimeout(() => {
                    window.location.reload();
                }, 2000);

            } catch (error) {
                console.error('âŒ Error creating test data:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // Fix exam dates function
        async function fixExamDates() {
            try {
                console.log('ğŸ”§ Fixing exam dates...');
                showLoading('Ø¬Ø§Ø±ÙŠ Ø¥ØµÙ„Ø§Ø­ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...');

                const result = await api.fixExamDates();
                console.log('âœ… Exam dates fixed:', result);

                showAlert('ØªÙ… Ø¥ØµÙ„Ø§Ø­ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');

                // Reload the page to see the updated data
                setTimeout(() => {
                    window.location.reload();
                }, 2000);

            } catch (error) {
                console.error('âŒ Error fixing exam dates:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // View available exams function
        function viewAvailableExams() {
            console.log('ğŸ‘ï¸ View available exams button clicked');

            // Scroll to the available exams section
            const availableExamsSection = document.getElementById('availableExamsList').parentElement.parentElement;
            availableExamsSection.scrollIntoView({ behavior: 'smooth' });

            // Highlight the section temporarily
            const originalBg = availableExamsSection.style.background;
            availableExamsSection.style.background = 'var(--primary-light)';
            availableExamsSection.style.transition = 'background 0.3s ease';

            setTimeout(() => {
                availableExamsSection.style.background = originalBg;
            }, 1000);

            // Show message if no exams are available
            const availableExamsCount = document.getElementById('availableExamsCount').textContent;
            if (availableExamsCount === '0') {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹', 'info');
            } else {
                showAlert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${availableExamsCount} Ø§Ø®ØªØ¨Ø§Ø± Ù…ØªØ§Ø­`, 'success');
            }
        }

        // Start exam function
        async function startExam(examId) {
            try {
                console.log('ğŸš€ Starting exam:', examId);

                showLoading('Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...');

                const result = await api.startStudentExam(examId);
                console.log('âœ… Exam started:', result);
                showAlert('Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'info');
                // Redirect to exam page
                setTimeout(() => {
                    window.location.href = `exam.html?id=${examId}`;
                }, 1000);
            } catch (error) {
                console.error('âŒ Error starting exam:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // Logout function
        function performLogout() {
            console.log('ğŸšª Logout button clicked');
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                api.logout();
            }
        }

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ğŸš€ Student dashboard page loaded');
            loadDashboardData();
        });
    </script>
</body>

</html>